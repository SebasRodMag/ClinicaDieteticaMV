<div class="container mt-4">
    <h2 class="mb-4">Gestión de Historiales</h2>

    <!-- Filtros -->
    <div class="row g-3 align-items-center mb-3">
        <div class="col-md-4">
            <input type="text" [(ngModel)]="filtro" placeholder="Buscar..." class="form-control" />
        </div>

        <div class="col-md-3">
            <input type="date" [(ngModel)]="filtroFecha" class="form-control" />
        </div>

        <div class="col-md-3">
            <select [(ngModel)]="pacienteSeleccionadoId" class="form-select">
                <option [ngValue]="null">Todos los pacientes</option>
                <option *ngFor="let p of pacientesUnicos" [ngValue]="p.id">{{ p.nombre }}</option>
            </select>
        </div>

        <div class="col-md-2 text-end">
            <button class="btn btn-outline-secondary" (click)="limpiarFiltros()">
                <i class="bi bi-x-circle me-1"></i> Limpiar filtros
            </button>

        </div>
        <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="col-md-2">
                <button class="btn btn-primary w-100" (click)="abrirModalNuevo()">
                    <i class="bi bi-plus-circle me-1"></i> Nuevo
                </button>
            </div>
            <div class="d-flex gap-1">
                <button class="btn btn-outline-success" (click)="intentarExportar('csv')">
                    <i class="bi bi-file-earmark-spreadsheet"></i> Exportar CSV
                </button>
                <button class="btn btn-outline-danger" (click)="intentarExportar('pdf')">
                    <i class="bi bi-filetype-pdf"></i> Exportar PDF
                </button>
            </div>



        </div>
    </div>
</div>

<!-- Tabla -->
<app-tabla-historial [historiales]="historialesFiltrados" [historialSeleccionadoId]="historialSeleccionadoId"
    (editar)="abrirModalEditar($event)" (eliminar)="eliminarHistorial($event)" (ver)="abrirModalVer($event)"
    (seleccionar)="seleccionarHistorial($event)" >
</app-tabla-historial>

<app-modal-edit-historial *ngIf="modalVisible" [visible]="modalVisible" [historial]="historialSeleccionado"
    [esNuevo]="esNuevo" [color]="colorSistema" (cerrar)="cerrarModal()" (guardar)="guardarHistorial($event)">
</app-modal-edit-historial>

<app-modal-ver-historial *ngIf="modalVerVisible && esHistorialValido(historialSeleccionado)" [visible]="modalVerVisible"
    [historial]="historialSeleccionado" [color]="colorSistema" (cerrar)="cerrarModalVer()">
</app-modal-ver-historial>


<!-- Fondo atenuado mientras el modal está visible -->
<div *ngIf="modalVisible" class="modal-backdrop fade show" style="z-index: 1050;"></div>